/*! asynquence-contrib
    v0.24.0 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
!function UMD(e,r){"undefined"!=typeof module&&module.exports?(module.exports=function $$inject$dependency(e){if("string"==typeof e)try{e=require(e)}catch(t){return $$inject$dependency}return r(e)},"string"==typeof e&&(module.exports=module.exports(require("path").join("..",e)))):"function"==typeof define&&define.amd?define([e],r):r(e)}(this.ASQ||"asynquence",function DEF(e){"use strict";function isPromise(r){var t=typeof r;return null!==r&&("object"==t||"function"==t)&&!e.isSequence(r)&&"function"==typeof r.then}var r=Array.prototype.slice,t=Object.create(null),n="__ASQ__",a=e.__schedule,u=e.__tapSequence;return e.extend("after",function $$extend(e,n){return function $$after(n){var a=arguments.length>1?r.call(arguments,1):void 0;return n=+n||0,e.then(function $$then(e){var u=a||r.call(arguments,1);setTimeout(function $$set$timeout(){e.apply(t,u)},n)}),e}}),e.after=function $$after(){return e().after.apply(t,arguments)},function IIFE(){var u;e.iterable=function $$iterable(){function throwSequenceErrors(){throw 1===$.length?$[0]:$}function notifyErrors(){var e;if(o=null,s)for(0!==f.length||l||(l=!0,throwSequenceErrors());f.length>0;){l=!0,e=f.shift();try{e.apply(t,$)}catch(r){checkBranding(r)?$=$.concat(r):$.push(r),0===f.length&&throwSequenceErrors()}}}function val(){if(s||c||0===arguments.length)return i;var e=r.call(arguments).map(function mapper(e){return"function"!=typeof e?function $$val(){return e}:e});return p.push.apply(p,e),i}function or(){return c||0===arguments.length?i:(f.push.apply(f,arguments),o||(o=a(notifyErrors)),i)}function pipe(){return c||0===arguments.length?i:(r.call(arguments).forEach(function $$each(e){val(e).or(e.fail)}),i)}function next(){if(s||c||0===p.length)return p.length>0&&$throw$("Sequence cannot be iterated"),{done:!0};try{return{value:p.shift().apply(t,arguments)}}catch(r){return e.isMessageWrapper(r)?$throw$.apply(t,r):$throw$(r),{}}}function $throw$(){return s||c?i:($.push.apply($,arguments),s=!0,o||(o=a(notifyErrors)),i)}function $return$(e){return(s||c)&&(e=void 0),abort(),{done:!0,value:e}}function abort(){s||c||(c=!0,clearTimeout(o),o=null,p.length=f.length=$.length=0)}function duplicate(){var r;return u={val_queue:p.slice(),or_queue:f.slice()},r=e.iterable(),u=null,r}function defer(){return f.push(function $$ignored(){}),i}function brandIt(e){return Object.defineProperty(e,n,{enumerable:!1,value:!0}),e}var i,o,s=!1,l=!1,c=!1,p=[],f=[],$=[];return i=brandIt({val:val,then:val,or:or,pipe:pipe,next:next,"throw":$throw$,"return":$return$,abort:abort,duplicate:duplicate,defer:defer}),i["function"==typeof Symbol&&Symbol.iterator||"@@iterator"]=function $$iter(){return i},u&&(p=u.val_queue.slice(0),f=u.or_queue.slice(0)),i.val.apply(t,arguments),i}}(),e.extend("race",function $$extend(n,a){return function $$race(){if(a("seq_error")||a("seq_aborted")||0===arguments.length)return n;var i=r.call(arguments).map(function $$map(r){var t;return e.isSequence(r)?(t={seq:r},u(t),function $$fn(e){t.seq.pipe(e)}):r});return n.then(function $$then(e){var n=r.call(arguments);i.forEach(function $$each(e){e.apply(t,n)})}),n}}),e.extend("runner",function $$extend(n,u){return function $$runner(){if(u("seq_error")||u("seq_aborted")||0===arguments.length)return n;var i=r.call(arguments);return n.then(function $$then(n){function wrap(r){return"function"==typeof r?(r=r.call(t,c),isPromise(r)&&(r=e.iterable(r))):r=e.isSequence(r)&&"next"in r?r.duplicate():e.iterable(r),e.isSequence(r)&&r.or(function $$or(){n.fail.apply(t,arguments)}),r}function addWrapped(){l.push.apply(l,r.call(arguments).map(wrap))}function iterateOrQuit(r,u){l.length>0?u?r():a(r):("undefined"!=typeof p?e.isMessageWrapper(p)||(p=[p]):p=[],n.apply(t,p))}var o,s,l=i,c={messages:r.call(arguments,1),add:addWrapped},p=c;l=l.map(wrap),function iterate(){o=l.shift();try{s=e.isMessageWrapper(p)&&e.isSequence(o)?o.next.apply(o,p):o.next(p)}catch(r){return n.fail(r)}if(!u("seq_aborted"))if(s.value===c)s.done||l.push(o),p=c,iterateOrQuit(iterate,!1);else{if(!e.isSequence(s.value))if(isPromise(s.value))s.value=e().promise(s.value);else if("function"==typeof s.value){var a=s.value;s.value=e(function $$ASQ(e){a(e.errfcb)})}else e.isMessageWrapper(s.value)?s.value=e.apply(t,s.value.length>0?s.value:e.messages(void 0)):"undefined"!=typeof s.value?s.value=e(s.value):s.value=e();s.value.val(function $$val(){u("seq_aborted")||(arguments.length>0&&(p=arguments.length>1?e.messages.apply(t,arguments):arguments[0]),s.done||(p===c?l.push(o):l.unshift(o)),iterateOrQuit(iterate,!0))}).or(function $$or(){if(!u("seq_aborted"))try{o["throw"].apply(o,arguments)}catch(e){n.fail(e)}})}}()}),n}}),e.extend("toPromise",function $$extend(n,a){return function $$to$promise(){return new Promise(function $$executor(a,u){n.val(function $$val(){var n=r.call(arguments);return a.call(t,n.length>1?n:n[0]),e.messages.apply(t,n)}).or(function $$or(){var e=r.call(arguments);u.call(t,e.length>1?e:e[0])})})}}),e.wrap=function $$wrap(n,a){function checkThis(e,r){return!e||"undefined"!=typeof window&&e===window||"undefined"!=typeof global&&e===global?r:e}function paramSpread(e){return regeneratorRuntime.mark(function paramSpread(r){return regeneratorRuntime.wrap(function paramSpread$(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(e.apply(this,r.messages),"t0",1);case 1:case"end":return t.stop()}},paramSpread,this)})}var u,i,o,s;if(a=a&&"object"==typeof a?a:{},a.errfcb&&a.splitcb||a.errfcb&&a.simplecb||a.splitcb&&a.simplecb||"errfcb"in a&&!a.errfcb&&!a.splitcb&&!a.simplecb||a.params_first&&a.params_last||a.spread&&!a.gen)throw Error("Invalid options");return s=a["this"]&&"object"==typeof a["this"]?a["this"]:t,u=a.errfcb||!(a.splitcb||a.simplecb),i=!!a.params_first||!a.params_last&&!("params_first"in a||a.params_first)||"params_last"in a&&!a.params_first&&!a.params_last,o=i?"push":"unshift",a.gen?(a.spread&&(n=paramSpread(n)),function $$wrapped$gen(){return e.apply(t,arguments).runner(n)}):u?function $$wrapped$errfcb(){var t=r.call(arguments),a=checkThis(this,s);return e(function $$asq(e){t[o](e.errfcb),n.apply(a,t)})}:a.splitcb?function $$wrapped$splitcb(){var t=r.call(arguments),a=checkThis(this,s);return e(function $$asq(e){t[o](e,e.fail),n.apply(a,t)})}:a.simplecb?function $$wrapped$simplecb(){var t=r.call(arguments),a=checkThis(this,s);return e(function $$asq(e){t[o](e),n.apply(a,t)})}:void 0},e});
